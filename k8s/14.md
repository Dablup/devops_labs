## Prometheus

- **The Prometheus Operator** - manages all the components from prometheus to work together.
- **Highly available Prometheus** - monitoring tool to gather metrics and alerting
- **Highly available Alertmanager** - tool that handles alerts sent by monitoring systems
- **Prometheus node-exporter** - tool that help to get hardware and OS metrics
- **Prometheus Adapter for Kubernetes Metrics APIs** - tool that help to get Kubernetes metrics
- **kube-state-metrics** - tool that listen Kubernetes server and generates metrics about server's objects
- **Grafana** - tool that help to work with data from monitoring, visualize and query it


1) Output of `kubectl get po,sts,svc,pvc,cm`. This command is used to display pods, statefulsets, services, persistent volume claims and configmaps deployed in our cluster.
```shell
daniil@Daniils-MacBook-Pro ~ % kubectl get po,sts,svc,pvc,cm
NAME                                                         READY   STATUS    RESTARTS        AGE
pod/alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   1 (4m41s ago)   5m4s
pod/prometheus-grafana-5d9f5d6499-kgqx5                      3/3     Running   0               5m18s
pod/prometheus-kube-prometheus-operator-79dd9d7c5f-q2mqx     1/1     Running   0               5m18s
pod/prometheus-kube-state-metrics-6cfd96f4c8-b8ld8           1/1     Running   0               5m18s
pod/prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   0               5m3s
pod/prometheus-prometheus-node-exporter-fwrx7                1/1     Running   0               5m18s
pod/time-app-time-application-0                              1/1     Running   126 (42s ago)   7d2h
pod/time-app-time-application-1                              1/1     Running   100 (42s ago)   7d2h

NAME                                                                    READY   AGE
statefulset.apps/alertmanager-prometheus-kube-prometheus-alertmanager   1/1     5m4s
statefulset.apps/prometheus-prometheus-kube-prometheus-prometheus       1/1     5m4s
statefulset.apps/time-app-time-application                              2/2     7d2h

NAME                                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP   5m4s
service/kubernetes                                ClusterIP   10.96.0.1        <none>        443/TCP                      7d2h
service/prometheus-grafana                        ClusterIP   10.105.166.51    <none>        80/TCP                       5m18s
service/prometheus-kube-prometheus-alertmanager   ClusterIP   10.96.203.37     <none>        9093/TCP                     5m18s
service/prometheus-kube-prometheus-operator       ClusterIP   10.96.44.183     <none>        443/TCP                      5m18s
service/prometheus-kube-prometheus-prometheus     ClusterIP   10.104.164.97    <none>        9090/TCP                     5m18s
service/prometheus-kube-state-metrics             ClusterIP   10.107.122.228   <none>        8080/TCP                     5m18s
service/prometheus-operated                       ClusterIP   None             <none>        9090/TCP                     5m4s
service/prometheus-prometheus-node-exporter       ClusterIP   10.111.13.244    <none>        9100/TCP                     5m18s
service/time-app-time-application                 ClusterIP   10.98.144.28     <none>        80/TCP                       7d2h

NAME                                                                   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistence-volume-time-app-time-application-0   Bound    pvc-62800c18-d0d7-4064-8727-b48f32199791   512Mi      RWO            standard       7d3h
persistentvolumeclaim/persistence-volume-time-app-time-application-1   Bound    pvc-13068d7b-7aa6-4def-830d-94b8d2ab9d1f   512Mi      RWO            standard       7d3h

NAME                                                                     DATA   AGE
configmap/kube-root-ca.crt                                               1      36d
configmap/prometheus-grafana                                             1      5m19s
configmap/prometheus-grafana-config-dashboards                           1      5m19s
configmap/prometheus-kube-prometheus-alertmanager-overview               1      5m19s
configmap/prometheus-kube-prometheus-apiserver                           1      5m19s
configmap/prometheus-kube-prometheus-cluster-total                       1      5m19s
configmap/prometheus-kube-prometheus-controller-manager                  1      5m19s
configmap/prometheus-kube-prometheus-etcd                                1      5m19s
configmap/prometheus-kube-prometheus-grafana-datasource                  1      5m19s
configmap/prometheus-kube-prometheus-grafana-overview                    1      5m19s
configmap/prometheus-kube-prometheus-k8s-coredns                         1      5m19s
configmap/prometheus-kube-prometheus-k8s-resources-cluster               1      5m19s
configmap/prometheus-kube-prometheus-k8s-resources-namespace             1      5m19s
configmap/prometheus-kube-prometheus-k8s-resources-node                  1      5m19s
configmap/prometheus-kube-prometheus-k8s-resources-pod                   1      5m19s
configmap/prometheus-kube-prometheus-k8s-resources-workload              1      5m19s
configmap/prometheus-kube-prometheus-k8s-resources-workloads-namespace   1      5m19s
configmap/prometheus-kube-prometheus-kubelet                             1      5m19s
configmap/prometheus-kube-prometheus-namespace-by-pod                    1      5m19s
configmap/prometheus-kube-prometheus-namespace-by-workload               1      5m18s
configmap/prometheus-kube-prometheus-node-cluster-rsrc-use               1      5m19s
configmap/prometheus-kube-prometheus-node-rsrc-use                       1      5m18s
configmap/prometheus-kube-prometheus-nodes                               1      5m18s
configmap/prometheus-kube-prometheus-nodes-darwin                        1      5m19s
configmap/prometheus-kube-prometheus-persistentvolumesusage              1      5m19s
configmap/prometheus-kube-prometheus-pod-total                           1      5m19s
configmap/prometheus-kube-prometheus-prometheus                          1      5m19s
configmap/prometheus-kube-prometheus-proxy                               1      5m18s
configmap/prometheus-kube-prometheus-scheduler                           1      5m19s
configmap/prometheus-kube-prometheus-workload-total                      1      5m19s
configmap/prometheus-prometheus-kube-prometheus-prometheus-rulefiles-0   29     5m4s
configmap/time-app-time-application-configmap                            1      7d2h
```


2) CPU and Memory my StatefulSet is consuming.<br>
![img_1.png](screenshots/b.png)


3) Which Pod is using CPU more than others and which is less in the default namespace
![img_2.png](screenshots/c.png)
![img_3.png](screenshots/d.png)


4) How much memory is used on your node, in % and mb.
![img_4.png](screenshots/e.png)


5) How many pods and containers actually ran by the Kubelet service
![img_5.png](screenshots/f.png)


6) Which Pod is using network more than others and which is less in the default namespace
![img_6.png](screenshots/g.png)


7) How many alerts we have:
![img_7.png](screenshots/h.png)
![img_8.png](screenshots/z.png)


## Init containers

1) After writing the `init-container.yaml`, I used command
`kubectl apply -f init-container.yaml` to deploy and run a pod.
![img_9.png](screenshots/y.png)


2) Proof that everything works (we should get the home page of first web-site - http://info.cern.ch/):
```shell
daniil@Daniils-MacBook-Pro templates % kubectl exec pod/init-container-application -- cat /usr/share/nginx/html/index.html
Defaulted container "init-container-application" out of: init-container-application, install (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```


